# 流量治理<a name="cce_01_0123"></a>

通过修改负载均衡方式，进行故障注入测试及配置基本连接池管理。

## 操作步骤<a name="section10774113201515"></a>

1.  单击左侧导航栏的“应用管理 \> 流量治理“，选择组件所在的集群、命名空间和应用。
2.  在拓扑图中，单击组件名称下的圆形图标。在负载均衡算法中，进行流量策略配置。

    **表 1**  负载均衡算法

    <a name="table446915575217"></a>
    <table><thead align="left"><tr id="row17470155511523"><th class="cellrowborder" valign="top" width="30.37%" id="mcps1.2.3.1.1"><p id="p2470125555217"><a name="p2470125555217"></a><a name="p2470125555217"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="69.63000000000001%" id="mcps1.2.3.1.2"><p id="p1947015545211"><a name="p1947015545211"></a><a name="p1947015545211"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row947045514524"><td class="cellrowborder" valign="top" width="30.37%" headers="mcps1.2.3.1.1 "><p id="p1647085518521"><a name="p1647085518521"></a><a name="p1647085518521"></a>负载均衡算法</p>
    </td>
    <td class="cellrowborder" valign="top" width="69.63000000000001%" headers="mcps1.2.3.1.2 "><a name="ul7632346152617"></a><a name="ul7632346152617"></a><ul id="ul7632346152617"><li>ROUND_ROBIN：轮询，默认负载均衡算法。</li><li>LEAST_CONN：随机选取两个健康的主机，再从所选取的两个主机中选择一个链接数较少的主机。</li><li>RANDOM：从所有健康的主机中，随机选取一个。</li><li>PASSTHROUGH：此模式将不会做任何负载均衡处理，会直接转发至请求内的源IP。</li></ul>
    </td>
    </tr>
    <tr id="row947065511523"><td class="cellrowborder" valign="top" width="30.37%" headers="mcps1.2.3.1.1 "><p id="p74702550520"><a name="p74702550520"></a><a name="p74702550520"></a>会话保持</p>
    </td>
    <td class="cellrowborder" valign="top" width="69.63000000000001%" headers="mcps1.2.3.1.2 "><p id="p114706553521"><a name="p114706553521"></a><a name="p114706553521"></a>根据HTTP header中的内容获取哈希，哈希一致的将会转发至同一主机。</p>
    </td>
    </tr>
    </tbody>
    </table>

3.  连接池管理。

    **表 2**  连接池管理

    <a name="table11194312533"></a>
    <table><thead align="left"><tr id="row71643115317"><th class="cellrowborder" valign="top" width="41%" id="mcps1.2.3.1.1"><p id="p181144375312"><a name="p181144375312"></a><a name="p181144375312"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="59%" id="mcps1.2.3.1.2"><p id="p1911643175312"><a name="p1911643175312"></a><a name="p1911643175312"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row121104318532"><td class="cellrowborder" valign="top" width="41%" headers="mcps1.2.3.1.1 "><p id="p111104375311"><a name="p111104375311"></a><a name="p111104375311"></a>最大连接数</p>
    </td>
    <td class="cellrowborder" valign="top" width="59%" headers="mcps1.2.3.1.2 "><p id="p311043155311"><a name="p311043155311"></a><a name="p311043155311"></a>到目标主机HTTP1或TCP连接的最大数量。</p>
    </td>
    </tr>
    <tr id="row91743155317"><td class="cellrowborder" valign="top" width="41%" headers="mcps1.2.3.1.1 "><p id="p17144365320"><a name="p17144365320"></a><a name="p17144365320"></a>每连接最大请求数</p>
    </td>
    <td class="cellrowborder" valign="top" width="59%" headers="mcps1.2.3.1.2 "><p id="p998718209553"><a name="p998718209553"></a><a name="p998718209553"></a>对后端连接中最大的请求数量若设为1则会禁止keep alive特性。</p>
    </td>
    </tr>
    <tr id="row71174345315"><td class="cellrowborder" valign="top" width="41%" headers="mcps1.2.3.1.1 "><p id="p71164365315"><a name="p71164365315"></a><a name="p71164365315"></a>最大请求重试次数</p>
    </td>
    <td class="cellrowborder" valign="top" width="59%" headers="mcps1.2.3.1.2 "><p id="p1118439536"><a name="p1118439536"></a><a name="p1118439536"></a>在指定时间内对目标主机最大重试次数。</p>
    </td>
    </tr>
    <tr id="row61164355314"><td class="cellrowborder" valign="top" width="41%" headers="mcps1.2.3.1.1 "><p id="p411543115311"><a name="p411543115311"></a><a name="p411543115311"></a>连接超时时间</p>
    </td>
    <td class="cellrowborder" valign="top" width="59%" headers="mcps1.2.3.1.2 "><p id="p1414437533"><a name="p1414437533"></a><a name="p1414437533"></a>TCP连接超时时间。</p>
    </td>
    </tr>
    <tr id="row868771917370"><td class="cellrowborder" valign="top" width="41%" headers="mcps1.2.3.1.1 "><p id="p668731913372"><a name="p668731913372"></a><a name="p668731913372"></a>最大等待请求数</p>
    </td>
    <td class="cellrowborder" valign="top" width="59%" headers="mcps1.2.3.1.2 "><p id="p168781913718"><a name="p168781913718"></a><a name="p168781913718"></a>等待列队的长度，默认为1024。</p>
    </td>
    </tr>
    </tbody>
    </table>

4.  故障注入。在故障类型中选择时延故障或中断故障。

    当前版本仅支持基于请求内容策略。

    **表 3**  时延故障

    <a name="table18984135181314"></a>
    <table><thead align="left"><tr id="row598425120134"><th class="cellrowborder" valign="top" width="27.839999999999996%" id="mcps1.2.3.1.1"><p id="p19984115171310"><a name="p19984115171310"></a><a name="p19984115171310"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="72.16%" id="mcps1.2.3.1.2"><p id="p1698485115139"><a name="p1698485115139"></a><a name="p1698485115139"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row998405120139"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p398410514130"><a name="p398410514130"></a><a name="p398410514130"></a>故障版本</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p13984135171312"><a name="p13984135171312"></a><a name="p13984135171312"></a>故障所作用的版本。</p>
    </td>
    </tr>
    <tr id="row0984115119131"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p5984175115132"><a name="p5984175115132"></a><a name="p5984175115132"></a>故障类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p164535441372"><a name="p164535441372"></a><a name="p164535441372"></a>时延故障对通往组件的请求有延迟。</p>
    </td>
    </tr>
    <tr id="row19984115115137"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p1198445191320"><a name="p1198445191320"></a><a name="p1198445191320"></a>故障百分比</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p19844519132"><a name="p19844519132"></a><a name="p19844519132"></a>故障按比例发生。</p>
    </td>
    </tr>
    <tr id="row1498435141310"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p198495117137"><a name="p198495117137"></a><a name="p198495117137"></a>延时</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p598495116135"><a name="p598495116135"></a><a name="p598495116135"></a>设定的时间延迟单位。</p>
    </td>
    </tr>
    </tbody>
    </table>

    **表 4**  中断故障

    <a name="table37365213498"></a>
    <table><thead align="left"><tr id="row1075165216497"><th class="cellrowborder" valign="top" width="27.839999999999996%" id="mcps1.2.3.1.1"><p id="p5761252194915"><a name="p5761252194915"></a><a name="p5761252194915"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="72.16%" id="mcps1.2.3.1.2"><p id="p677205234920"><a name="p677205234920"></a><a name="p677205234920"></a>参数说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row147845294920"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p080952194911"><a name="p080952194911"></a><a name="p080952194911"></a>故障版本</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p1681452164914"><a name="p1681452164914"></a><a name="p1681452164914"></a>故障所作用的版本。</p>
    </td>
    </tr>
    <tr id="row181952124915"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p5821352114919"><a name="p5821352114919"></a><a name="p5821352114919"></a>故障类型</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p8659152212810"><a name="p8659152212810"></a><a name="p8659152212810"></a>中断故障会中断该组件的服务并返回预设状态码。</p>
    </td>
    </tr>
    <tr id="row08819526492"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p1989252164912"><a name="p1989252164912"></a><a name="p1989252164912"></a>故障百分比</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p68935215497"><a name="p68935215497"></a><a name="p68935215497"></a>故障按比例发生。</p>
    </td>
    </tr>
    <tr id="row39095224919"><td class="cellrowborder" valign="top" width="27.839999999999996%" headers="mcps1.2.3.1.1 "><p id="p79110521491"><a name="p79110521491"></a><a name="p79110521491"></a>Http状态码</p>
    </td>
    <td class="cellrowborder" valign="top" width="72.16%" headers="mcps1.2.3.1.2 "><p id="p694105218496"><a name="p694105218496"></a><a name="p694105218496"></a>终止故障时返回的http状态码，默认返回500。</p>
    </td>
    </tr>
    </tbody>
    </table>

5.  （可选）取消故障注入。

    如若不需要继续触发故障，可单击故障类型中的“不启用”来删除已配置的故障。



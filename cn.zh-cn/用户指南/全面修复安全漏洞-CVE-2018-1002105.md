# 全面修复安全漏洞 CVE-2018-1002105<a name="cce_01_0194"></a>

近日，Kubernetes社区发现安全漏洞 CVE-2018-1002105。通过伪造请求，Kubernetes用户可以在已建立的API Server连接上提权访问后端服务，华为云容器服务已在第一时间完成全面修复。

**表 1**  漏洞信息

<a name="table1565618845915"></a>
<table><thead align="left"><tr id="row065718811595"><th class="cellrowborder" valign="top" width="25%" id="mcps1.2.5.1.1"><p id="p265798165915"><a name="p265798165915"></a><a name="p265798165915"></a>漏洞类型</p>
</th>
<th class="cellrowborder" valign="top" width="25%" id="mcps1.2.5.1.2"><p id="p465798195911"><a name="p465798195911"></a><a name="p465798195911"></a>CVE-ID</p>
</th>
<th class="cellrowborder" valign="top" width="25%" id="mcps1.2.5.1.3"><p id="p365720810595"><a name="p365720810595"></a><a name="p365720810595"></a>披露/发现时间</p>
</th>
<th class="cellrowborder" valign="top" width="25%" id="mcps1.2.5.1.4"><p id="p1365711835912"><a name="p1365711835912"></a><a name="p1365711835912"></a>华为云修复时间</p>
</th>
</tr>
</thead>
<tbody><tr id="row19657198185917"><td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.1 "><p id="p8360204615313"><a name="p8360204615313"></a><a name="p8360204615313"></a>权限提升</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.2 "><p id="p164879615323"><a name="p164879615323"></a><a name="p164879615323"></a><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-1002105" target="_blank" rel="noopener noreferrer">CVE-2018-1002105</a></p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.3 "><p id="p206589816592"><a name="p206589816592"></a><a name="p206589816592"></a>2018-12-05</p>
</td>
<td class="cellrowborder" valign="top" width="25%" headers="mcps1.2.5.1.4 "><p id="p2658198115913"><a name="p2658198115913"></a><a name="p2658198115913"></a>2018-12-05</p>
</td>
</tr>
</tbody>
</table>

漏洞详细介绍：[https://github.com/kubernetes/kubernetes/issues/71411](https://github.com/kubernetes/kubernetes/issues/71411)

## 影响版本<a name="section1840413214196"></a>

-   Kubernetes v1.0.x-1.9.x
-   Kubernetes v1.10.0-1.10.10 \(fixed in v1.10.11\)
-   Kubernetes v1.11.0-1.11.4 \(fixed in v1.11.5\)
-   Kubernetes v1.12.0-1.12.2 \(fixed in v1.12.3\)

## 影响的配置<a name="section2586954102217"></a>

集群启用了扩展API server，并且kube-apiserver与扩展API server的网络直接连通；

集群对攻击者可见，即攻击者可以访问到kube-apiserver的接口，如果你的集群是部署在安全的私网内，那么不会有影响；

集群开放了 pod exec/attach/portforward 接口，则攻击者可以利用该漏洞获得所有的kubelet API访问权限。

## 具体影响场景<a name="section15203556132414"></a>

集群使用了聚合API，只要kube-apiserver与聚合API server的网络直接连通，攻击者就可以利用这个漏洞向聚合API服务器发送任何API请求；

如果集群开启了匿名用户访问的权限，则匿名用户也利用这个漏洞。不幸的是Kubernetes默认允许匿名访问，即kube-apiserver的启动参数”-- anonymous-auth=true”；

给予用户Pod的exec/attach/portforward的权限，用户也可以利用这个漏洞升级为集群管理员，可以对任意Pod做破坏操作；

该漏洞的更详细讨论，可见社区Issue：[https://github.com/kubernetes/kubernetes/issues/71411](https://github.com/kubernetes/kubernetes/issues/71411)

## 应对措施与建议<a name="section0943357142512"></a>

**综合以上分析，使用华为云CCE服务的小伙伴们不必过于担心**，因为：

-   CCE服务创建的集群默认关闭匿名用户访问权限。
-   CCE服务创建的集群没有使用聚合API。

华为云容器引擎已完成1.11以上版本Kubernetes集群的在线补丁修复，针对低于v1.10的集群（社区已不对其进行修复），已提供补丁版本进行修复，请关注升级公告，及时修复漏洞。

>![](public_sys-resources/icon-note.gif) **说明：** 
>如果你是自己搭建Kubernetes集群，为提高集群的安全系数，建议如下，一定要关闭匿名用户访问权限。
>尽快升级到社区漏洞修复版本。合理配置RBAC，只给可信用户Pod的exec/attach/portforward权限。
>如果你当前使用的Kubernetes版本低于v1.10，不在官方补丁支持范围内，建议自行回合补丁代码 ：[https://github.com/kubernetes/kubernetes/pull/71412](https://github.com/kubernetes/kubernetes/pull/71412)。


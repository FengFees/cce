# 创建应用<a name="cce_01_0037"></a>

当需要部署一个新的应用到CCE容器引擎上时，首先要创建应用。

## 应用基本概念<a name="section532320151509"></a>

-   应用是一个独立完整的业务功能（例如一个电商网站就是一个应用）。应用管理提供了应用创建、维护，应用内组件创建、发布、治理的端到端功能。
-   应用由一个或多个特定功能的组件组成（例如一个PHP的前端就是一个组件），每个组件可以独立于其他组件启动、运行、治理。
-   一个组件包含一个或多个版本，每个版本对应一个工作负载。

    **图 1**  应用与工作负载的关系<a name="fig2890163004910"></a>  
    ![](figures/应用与工作负载的关系.png "应用与工作负载的关系")


## 前提条件<a name="section19807725165016"></a>

创建应用前，请确保系统中有可用集群，且已启用“服务网格“，若没有请参照[创建虚拟机集群](创建虚拟机集群.md)中内容创建。

>![](public_sys-resources/icon-note.gif) **说明：**   
>创建多个容器应用时，请确保容器应用使用的端口不冲突 ，否则部署会失败。  

## 创建应用<a name="section74714184469"></a>

1.  在CCE左侧导航栏中选择“应用治理“，打开[应用服务网格控制台](https://console.huaweicloud.com/istio/)，单击“创建应用“，选择“向导式创建“。
2.  设置应用基本信息。
    -   应用名称：新建容器应用的名称，命名必须唯一。
    -   集群名称：新建应用所在的集群。
    -   命名空间：在单集群中，不同命名空间中的数据彼此隔离。使应用可以共享同个集群的服务，也能够互不干扰。若您不设置命名空间，系统会默认使用default命名空间。
    -   应用描述：应用描述信息。

3.  在组件区域下，单击“添加组件“。
    -   组件名称：新建应用中组件的名称，命名必须唯一。
    -   组件负载类型：目前仅支持“无状态负载“。在运行中始终不保存任何数据或状态的应用称为“无状态负载（deployment）”，例如nginx。
    -   组件描述：组件描述信息。

4.  在“组件访问设置“区域下，配置组件访问方式，使组件可以被应用的其它组件访问。
    -   端口协议：选择请求协议，目前支持http和tcp协议。
    -   端口名称：自定义端口名称，例如http-a0009。
    -   访问端口：为外界访问该组件（即对应的负载）提供一个端口号。端口范围为1-65535，可任意指定。
    -   容器端口：为组件的访问端口号配置一个映射端口号来指向容器，需用户确定。例如nginx程序实际监听端口为80。

5.  单击“下一步“，设置K8S负载配置。
    -   版本名称：输入版本名称。
    -   实例个数：组件的实例数量。组件可以有一个或多个实例，用户可以设置具体实例个数，默认为2，可自定义设置为其他值。每个组件的实例都由相同的容器部署而成。设置多个组件主要用于实现高可靠性，当某个实例故障时，应用还能正常运行。
    -   版本描述：组件的描述信息。
    -   负载配置：单击待选择镜像下的“使用该镜像“。若无所需镜像，可单击“上传镜像“，到容器镜像服务中上传。
        -   我的镜像：展示了您上传的所有镜像。
        -   华为官方镜像：展示了华为官方镜像。


6.  选择镜像后，配置镜像参数。

    **表 1**  添加容器参数说明

    <a name="table10949134618544"></a>
    <table><thead align="left"><tr id="row18948164613548"><th class="cellrowborder" valign="top" width="23%" id="mcps1.2.3.1.1"><p id="p15948134610543"><a name="p15948134610543"></a><a name="p15948134610543"></a>参数</p>
    </th>
    <th class="cellrowborder" valign="top" width="77%" id="mcps1.2.3.1.2"><p id="p69481046125415"><a name="p69481046125415"></a><a name="p69481046125415"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row18948446125416"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p3948174612540"><a name="p3948174612540"></a><a name="p3948174612540"></a>镜像名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p1394818463547"><a name="p1394818463547"></a><a name="p1394818463547"></a>导入的镜像，您可单击<span class="uicontrol" id="uicontrol89481846135416"><a name="uicontrol89481846135416"></a><a name="uicontrol89481846135416"></a>“更换镜像”</span>进行更换。</p>
    </td>
    </tr>
    <tr id="row094894620549"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p1994854615549"><a name="p1994854615549"></a><a name="p1994854615549"></a>镜像版本</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p894854614544"><a name="p894854614544"></a><a name="p894854614544"></a>选择需要部署的镜像版本。</p>
    </td>
    </tr>
    <tr id="row15948114615416"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p6948134614549"><a name="p6948134614549"></a><a name="p6948134614549"></a>容器名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><p id="p19948164635413"><a name="p19948164635413"></a><a name="p19948164635413"></a>容器的名称，可修改。</p>
    </td>
    </tr>
    <tr id="row1694964695412"><td class="cellrowborder" valign="top" width="23%" headers="mcps1.2.3.1.1 "><p id="p594854645416"><a name="p594854645416"></a><a name="p594854645416"></a>容器规格</p>
    </td>
    <td class="cellrowborder" valign="top" width="77%" headers="mcps1.2.3.1.2 "><div class="p" id="p294914466544"><a name="p294914466544"></a><a name="p294914466544"></a>申请和限制的含义如下。详细请参见<a href="设置容器规格.md">设置容器规格</a>。<a name="ul109494467548"></a><a name="ul109494467548"></a><ul id="ul109494467548"><li>申请：表示应用运行所需最少资源。</li><li>限制：若担心应用超载，导致系统故障。建议设置应用配额的最高限制。确保应用资源不会超额。</li></ul>
    </div>
    </td>
    </tr>
    </tbody>
    </table>

7.  配置生命周期：用于管理容器各阶段需要执行的命令。
    -   启动命令：设置容器启动时执行的命令，详情请参见[设置容器启动命令](设置容器启动命令.md)。
    -   启动后处理：设置容器成功运行后执行的命令，详细配置方法请参见[设置容器生命周期](设置容器生命周期.md)。
    -   停止前处理：设置容器结束前执行的命令，通常用于删除日志/临时文件等，详细配置方法请参见[设置容器生命周期](设置容器生命周期.md)。

8.  设置健康检查：用于判断容器和用户业务是否正常运行。设置存活与业务两种探针，详情配置方法同[容器健康检查](容器健康检查.md)。
    -   应用存活探针：监测到容器实例不健康时，重启应用。
    -   应用业务探针：监测到容器实例不健康时，将工作负载设置为未就绪状态，业务流量不会导入到该容器中。

9.  设置环境变量：在容器中添加环境变量，一般用于通过环境变量设置参数。
    1.  在“环境变量“页签，单击“添加环境变量“。
    2.  输入变量名称、变量/变量引用。

10. 数据存储：给容器挂载数据存储，适用于需持久化存储、高磁盘IO等场景。详细配置请参见[存储管理](存储管理.md)。
11. 容器日志：设置容器日志采集策略、配置日志目录。用于收集容器日志便于统一管理和分析。详细配置请参见[日志管理](日志管理.md)。
12. （可选）若组件包含多个容器，请单击“添加容器“，并配置容器相关参数。
13. 单击“下一步“，配置高级设置。
    -   升级策略：支持“替换升级“和“滚动升级“。
        -   替换升级：先删除旧实例，再创建新实例。升级过程中业务会中断。
        -   滚动升级：滚动升级将逐步用新版本的实例替换旧版本的实例，升级的过程中，业务流量会同时负载均衡分布到新老的实例上，因此业务不会中断。

    -   缩容策略：输入时间。为工作负载删除提供一个时间窗，预留给生命周期中PreStop阶段执行命令。若超过此时间窗，进程仍未停止，该工作负载将被强制删除。
    -   自定义指标监控：是指监控系统提供的一种指标收集机制，该机制允许工作负载在部署时自定义需要上报的指标名称以及获取这些指标数据的接入点信息，在应用运行时由监控系统按固定的频率访问接入点进行指标的收集。详细请参见[对接普罗米修斯（自定义监控）](对接普罗米修斯（自定义监控）.md)。
    -   性能管理配置：华为云的性能管理服务可协助您快速进行工作负载的问题定位与性能瓶颈分析。详细请参见[性能管理配置（性能瓶颈分析）](性能管理配置（性能瓶颈分析）.md)。

14. 单击“添加“，组件添加成功。您还可以单击“添加组件“，添加更多组件。
15. 在“应用访问设置“区域下，单击“添加应用访问方式“，配置路由信息，输入应用访问配置参数。
    -   组件名称：选择对应的组件。
    -   对外协议：公网访问应用使用的协议，目前支持HTTP和TCP协议。
    -   组件对外访问地址：请填写组件对外发布域名，域名需用户自行申请，并确保所填写域名能解析到所选负载均衡实例的服务地址。若不填写默认地址为负载均衡实例IP地址。
    -   对外端口：开放在负载均衡服务地址的端口。

16. 配置完成后，单击“确定“。
17. 单击“创建“，创建应用。


# CVE-2020-8558漏洞公告<a name="cce_01_0204"></a>

在Kubernetes中发现了一个漏洞，该漏洞使相邻网络上的攻击者可以访问在localhost端口上公开的服务，该端口以前被认为无法访问。此缺陷使攻击者可以获得特权或访问侦听不受身份验证保护的本地主机端口的任何服务的机密信息。

## 漏洞详情<a name="section205301931171815"></a>

在kube-proxy中发现了一个安全漏洞，它允许相邻的主机（运行在同一局域网或第2层域的主机）访问绑定在127.0.0.1的节点上的TCP和UDP服务。例如，如果集群管理员运行监听了127.0.0.1:1234的TCP服务，由于这个bug，该服务将有可能被与该节点在同一局域网中的其他主机，或与该服务运行在同一节点上的容器所访问。如果端口1234上的服务不需要额外的认证（因为假设只有其他localhost进程可以），那么很容易受到利用此bug进行攻击。

**表 1**  漏洞信息

<a name="table1565618845915"></a>
<table><thead align="left"><tr id="row065718811595"><th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.1"><p id="p265798165915"><a name="p265798165915"></a><a name="p265798165915"></a>漏洞类型</p>
</th>
<th class="cellrowborder" valign="top" width="50%" id="mcps1.2.3.1.2"><p id="p465798195911"><a name="p465798195911"></a><a name="p465798195911"></a>CVE-ID</p>
</th>
</tr>
</thead>
<tbody><tr id="row1120510564498"><td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.1 "><p id="p177230203311"><a name="p177230203311"></a><a name="p177230203311"></a>代码注入</p>
</td>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.3.1.2 "><p id="p1665713818593"><a name="p1665713818593"></a><a name="p1665713818593"></a><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8558" target="_blank" rel="noopener noreferrer">CVE-2020-8558</a></p>
</td>
</tr>
</tbody>
</table>

## 影响范围<a name="section8950149204115"></a>

在下列版本的kube-proxy组件均在此CVE的影响范围内：

-   kube-proxy v1.18.0\~v1.18.3
-   kube-proxy v1.17.0\~v1.17.6
-   kube-proxy <v1.16.10

CCE集群控制面已经通过安全组进行防护，只允许从租户节点或者相邻节点访问安全端口，默认安全。

集群node节点上系统组件监听在127.0.0.1的端口只涉及健康检查、监控信息查询等请求，不会有信息泄露风险。

综上，该CVE对CCE集群影响不大。

## 漏洞影响<a name="section19672042204216"></a>

当攻击者拥有主机网络配置能力或运行在一个具备了CAP\_NET\_RAW 能力的容器实例时，就可以获取在目标节点上监听了127.0.0.1的服务socket信息。如果在目标主机上存在127.0.0.1可以访问到且不需要任何认证鉴权的暴露服务，那么该服务信息就能被攻击者获取。问题详情请参见[Placeholder issue](https://github.com/kubernetes/kubernetes/issues/92315)。

可能的攻击者：

-   同一交换机内的其他共享主机实例。
-   本机的运行容器。

## 防范措施<a name="section68981337185515"></a>

建议您采取以下安全防范措施：

-   执行以下命令，在集群中配置iptables规则，用于拒绝非本地对127.0.0.1的访问流量：

    ```
     iptables -I INPUT --dst 127.0.0.0/8 ! --src 127.0.0.0/8 -m conntrack ! --ctstate RELATED,ESTABLISHED,DNAT -j DROP
    ```

-   如集群内运行有不受信的容器，需要manifest文件中关闭CAP\_NET\_RAW能力：

    ```
    securityContext:
          capabilities:
            drop: ["NET_RAW"]
    ```


